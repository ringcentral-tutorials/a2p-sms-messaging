<!DOCTYPE html><html><head><title>Build your A2P SMS Messaging- RingCentral Developer Tutorials</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="72x72" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="114x114" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div class="dpw-header-container"><div class="dpw-header left-section"><div class="logo"><a href="https://developers.ringcentral.com" class="logo-link"></a></div></div></div><div id="viewsaurus" data-title="Build your A2P SMS Messaging"><div class="saurus-panes"><div class="saurus-panes-header"><a href="https://ringcentral.github.io/tutorials/" class="saurus-back-to-tutorials">Tutorials</a><span>&gt;</span><span>Build your A2P SMS Messaging</span></div><div class="saurus-prose"><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw icon-menu"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn how to build an A2P SMS messaging app using RingCentral Messaging APIs. Click the &quot;Start Tutorial&quot; button below to start.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="A2P-SMS-Messaging Tutorial" class="chapter"><div data-title="Welcome!" data-file="README.md" data-highlight="1-8" class="step"><h2 id="welcome-to-the-tutorial">Welcome to the tutorial</h2>
<p>This tutorial shows how to use RingCentral SMS and Push Notification APIs to implement a SMS bot. The bot will listen for incoming text commands then reply to the sender with relevant content.</p>
<h3 id="text-commands-syntax-">Text commands syntax:</h3>
<ul>
<li><strong>?</strong> Or <strong>help</strong> for help.</li>
<li><strong>symbol/n</strong> for getting a list of foreign currency symbols, where n is the first alphabet of a country’s name.</li>
<li><strong>base/target</strong> for getting a current exchange rate, where target is the currency symbol to be quoted against the base currency symbol.</li>
</ul>
<h3 id="requirements">Requirements</h3>
<p>You must have a RingCentral developer account. If you don&#39;t have one, click <a href="https://developer.ringcentral.com">here</a> to create a free developer account.</p>
<p>You also have to <a href="https://developer.ringcentral.com/library/getting-started.html">create a RingCentral app</a> with the &quot;SMS&quot; and &quot;Webhook Subscriptions&quot; permissions. And retrieve the AppKey and AppSecret for using with this tutorial.</p>
</div><div data-title="Project setup" data-file="README.md" class="step"><h2 id="clone-the-project-from-github">Clone the project from GitHub</h2>
<p>Run the commands below to clone the project from GitHub</p>
<p><code>git clone https://github.com/ringcentral-tutorials/a2p-sms-messaging</code></p>
<p><code>cd a2p-sms-messaging</code></p>
<p><code>npm intall --save</code></p>
</div><div data-title="Set environment" data-file="dotenv" class="step"><h2 id="specify-environment-parameters">Specify environment parameters</h2>
<p>Rename the dotenv to .env and provide your app credentials, RingCentral sandbox account&#39;s username and password.</p>
<ul>
<li><strong>Note</strong>: The username is the account number and it is also the phone number we will use to send SMS from. If you want to use another number under this account, you can create a new variable and specify the phone number and use that number for sending SMS instead.</li>
</ul>
<p>We will start the tutorial with Webhook notification. Then we will discuss about using PubNub later.</p>
<p>Replace this &quot;YOUR_WEBHOOK_ADDRESS&quot; with your webhook address</p>
<p>If you run the app in a localhost, you can use <a href="https://ngrok.com/download">ngrok</a> to get an address</p>
</div><div data-title="Use Webhook" data-file="index.js" data-highlight="11-21" class="step"><h2 id="let-s-start-with-webhook-notification">Let&#39;s start with Webhook notification</h2>
<p>If the DELIVERY_MODE_TRANSPORT_TYPE is specified with &quot;WebHook&quot;, we create a http server with a callback function to handle HTTP requests.</p>
</div><div data-title="Instantiate RingCentral SDK" data-file="webhook.js" data-highlight="8-15" class="step"><h2 id="instantiate-the-ringcentral-node-js-sdk">Instantiate the RingCentral Node JS SDK</h2>
<p>First, we create the SDK instance <code>rcsdk</code> and initialize it with the AppKey and AppSecret.</p>
<p>Then we call the <code>rcsdk.platform()</code> function to get the instance of the platform component. The <code>platform</code> instance will be used later to login and call RingCentral APIs.</p>
</div><div data-title="Login to RingCentral account" data-file="webhook.js" data-highlight="18-32" class="step"><h2 id="login-to-ringcentral-account">Login to RingCentral account</h2>
<p>To login RingCentral account, we call the <code>platform.login()</code> function with the given account&#39;s username and password.</p>
</div><div data-title="Implement Notification Subscription" data-file="webhook.js" data-highlight="24-26" class="step"><h2 id="implement-notification-subscription">Implement notification subscription</h2>
<p>After logged in successfully, we get ready to subscribe for Webhook notifications so that we can receive incoming SMS messages.</p>
</div><div data-title="Create Notification Subscription" data-file="webhook.js" data-highlight="55-63" class="step"><h2 id="create-notification-subscription">Create notification subscription</h2>
<p>Before creating a new subscription for notification, we may need to detect if we have created one earlier. This step is necessary because the app could be terminated and rerun for any reason.</p>
<p>When a push notification subscription is registered successfully, we will receive a response with the subscription ID. We will save the subscription ID locally (in this project we save it in the subscriptionId.txt file) so that we can use it to handle (renew, delete etc.) the registered subscription.</p>
<p>When we run the app for the first time, we don&#39;t have the <strong>subscriptionId</strong> (or the file does not exists), we will call the <code>startWebhookSubscription()</code> function, where we will register for a new subscription.</p>
<p>When we rerun the app, we may already had the subscription registered previously. In that case, we read the <strong>subscriptionId</strong> from the local file, then we will call the <code>readRegisteredSubscription(data)</code> function with the <strong>subscriptionId</strong> to handle the existing subscription.</p>
</div><div data-title="Subscribe for Notifications" data-file="webhook.js" data-highlight="65-91" class="step"><h2 id="subscribe-for-notifications">Subscribe for notifications</h2>
<p>RingCentral push notification supports multiple events notification. This means that we can subscribe for notifications of several different events such as when there is an incoming SMS, when a SMS message is deleted, when there is an incoming call etc. in a single subscription.</p>
<p>In this particular app, we are interested at instant SMS only. Thus, we subscribe for just one event type of <code>instant?type=SMS</code>.</p>
<p>Then we use the <code>platform.post()</code> function to call the <strong>subscription</strong> API with the specified event type and the <strong>deliveryMode</strong> required for Webhook.</p>
<p>After registered successfully, we parse the response to get the subscription Id and save it to the local file &quot;subscriptionId.txt&quot;.</p>
<p>That is all we need to setup for the notification subscription using Webhook.</p>
</div><div data-title="Renew Webhook Notification" data-file="webhook.js" data-highlight="93-121" class="step"><h2 id="renew-webhook-notification">Renew Webhook notification</h2>
<p>In the other scenario, if we rerun the app and already had the <strong>subscriptionId</strong>. We will call the <code>readRegisteredSubscription(data)</code> to handle the existing subscription.</p>
<p>Currently, a registered Webhook subscription will expire after 7 days. When a subscription expires, it&#39;s status will be in <code>Suspended</code> and RingCentral server will stop sending notification to that subscriber.</p>
<p>We can either delete the <code>Suspended</code> subscription and create a new one, or just renew it. In this project, we choose to renew the subscription if it has expired.</p>
<p><strong>Important!</strong>: In real application situation, where the notification subscription must be <code>Active</code> all the time. We need to implement a scheduler to check the subscription status and renew it in time before it gets expired.</p>
<p>That is all for the renew notification subscription using Webhook.</p>
</div><div data-title="Receive Webhook POST message" data-file="index.js" data-highlight="12-19" class="step"><h2 id="receive-webhook-post-message">Receive Webhook POST message</h2>
<p>Whenever there is an incoming SMS, RingCentral will send a notification to the subscriber via the provided Webhook address.</p>
<p>We just do a quick check to see if the POST url is our predefined &quot;/webhooks&quot; path. If it matches, then we call the <code>rc_server.handleWebhooksPost(req, res)</code> function to handle the request.</p>
</div><div data-title="Read the SMS message" data-file="webhook.js" data-highlight="33-52" class="step"><h2 id="read-the-sms-message">Read the SMS message</h2>
<p>Looking at the code on the right-hand side, you can ignore the validateToken part. That is for validating the token when we registered for the subscription.</p>
<p>When this function is called as a notification for an incoming SMS, we read the data buffer to get the SMS message.</p>
<p>Then we call the <code>parseMessage()</code> with the data to process the SMS message.</p>
</div><div data-title="Parse the SMS message" data-file="webhook.js" data-highlight="147-157" class="step"><h2 id="parse-the-sms-message">Parse the SMS message</h2>
<p>Now, we extract the phone number of the sender. We will use the number for sending a message back to the sender.</p>
<p>We also extract the message&#39;s subject, which is the text command in this scenario.</p>
<p><strong>Note</strong>: Because we are testing with a RingCentral sandbox account, there is a watermark text attached to the text message. To work-around this in our demo, we suppress the watermark text before handling the command.</p>
</div><div data-title="Compose a reply message" data-file="webhook.js" data-highlight="158-197" class="step"><h2 id="compose-a-reply-message">Compose a reply message</h2>
<p>We use the command syntax for creating an appropriated reply message.</p>
<p>If the command is &quot;<strong>?</strong>&quot; or &quot;<strong>help</strong>&quot;, we reply with the instructions.</p>
<p>If the command has a slash &quot;<strong>/</strong>&quot;, we detect if it is a request for getting currency symbols or for getting an exchange rate.</p>
<ul>
<li><p>For a SYMBOL request, we get the currency codes from the predefined <code>currencySymbols</code> table.</p>
</li>
<li><p>For an exchange rate request, we use the base and the target currency codes and call &quot;api.fixer.io&quot; service to get the latest exchange rate.</p>
</li>
</ul>
<p>If the text command does not match with our command syntax, we compose an error message.</p>
</div><div data-title="Send a SMS message" data-file="webhook.js" data-highlight="199-208" class="step"><h2 id="send-a-sms-message">Send a SMS message</h2>
<p>We use the <code>platform.post()</code> function to call the SMS API with the specified parameters:</p>
<p>The <code>from</code> number is our RingCentral phone number specified in the environment file.</p>
<p>The <code>to</code> number is the sender&#39;s phone number we extract from the sender&#39;s SMS message</p>
<p>The <code>text</code> is the composed response we created in the previous step.</p>
<p>Our demo app is ready for test.</p>
<p>Just run <code>node index.js</code> and send a text message with &quot;help&quot; to the phone number you specified in the .env file</p>
<h3 id="if-you-want-to-learn-how-to-use-pubnub-notification-channel-click-the-next-step-">If you want to learn how to use PubNub notification channel, click the next step.</h3>
</div><div data-title="Use PubNub" data-file="dotenv" data-highlight="12" class="step"><h2 id="let-s-start-with-pubnub-notification">Let&#39;s start with PubNub notification</h2>
<p>To use PubNub for notification, we change the value of the DELIVERY_MODE_TRANSPORT_TYPE to &quot;PubNub&quot;</p>
<p><code>DELIVERY_MODE_TRANSPORT_TYPE=PubNub</code></p>
</div><div data-title="Use PubNub Notification" data-file="index.js" data-highlight="21-24" class="step"><h2 id="use-pubnub-notification">Use PubNub notification</h2>
<p>If the DELIVERY_MODE_TRANSPORT_TYPE is specified with &quot;PubNub&quot;, we create a http server and load the <strong>pubnub.js</strong> file accordingly.</p>
</div><div data-title="Instantiate the RingCentral SDK" data-file="pubnub.js" data-highlight="8-21" class="step"><h2 id="instantiate-the-ringcentral-node-js-sdk">Instantiate the RingCentral Node JS SDK</h2>
<p>First, we create the SDK instance <code>rcsdk</code> and initialize it with the AppKey and appSecret.</p>
<p>Then we call the <code>platform()</code> function to get the instance of the platform component. The <code>platform</code> instance will be used later to login and call RingCentral APIs.</p>
<p>We also call the <code>rcsdk.createSubscription()</code> function to create a <code>subscription</code> instance and implement an event handler function to receive notification events.</p>
</div><div data-title="Login RingCentral Account" data-file="pubnub.js" data-highlight="23-38" class="step"><h2 id="login-ringcentral-account">Login RingCentral account</h2>
<p>To login RingCentral account, we call the <code>platform.login()</code> function with the given account&#39;s username and password.</p>
</div><div data-title="Implement Notification Subscription" data-file="pubnub.js" data-highlight="29-31" class="step"><h2 id="implement-notification-subscription">Implement notification subscription</h2>
<p>After logged in successfully, we get ready to subscribe for PubNub notification so that we can receive incoming SMS messages.</p>
</div><div data-title="Create Notification Subscription" data-file="pubnub.js" data-highlight="40-48" class="step"><h2 id="create-notification-subscription">Create notification subscription</h2>
<p>Before creating a new subscription for notification, we may need to detect if we have created one earlier. This step is necessary because the app could be terminated and rerun for any reason.</p>
<p>When a push notification subscription is registered successfully, we will receive a response with the subscription ID. We will save the subscription ID locally (in this project we save it in the subscriptionId.txt file) so that we can use it to handle (renew, delete etc.) the registered subscription.</p>
<p>When we run the app for the first time, we don&#39;t have the <strong>subscriptionId</strong> (or the file does not exists), we will call the <code>startPubNubSubscription()</code> function, where we will register for a new subscription.</p>
<p>When we rerun the app, we may already had the subscription registered previously. In that case, we read the <strong>subscriptionId</strong> from the local file, then we will call the <code>readRegisteredSubscription(data)</code> function with the <strong>subscriptionId</strong> to handle the existing subscription.</p>
</div><div data-title="Subscribe for Notifications" data-file="pubnub.js" data-highlight="59-73" class="step"><h2 id="subscribe-for-notifications">Subscribe for notifications</h2>
<p>RingCentral push notification supports multiple events notification. This means that we can subscribe for notifications of several different events such as when there is an incoming SMS, when a SMS message is deleted, when there is an incoming call etc. in a single subscription.</p>
<p>In this particular app, we are interested at incoming SMS only. Thus, we subscribe for just one event type of <code>instant?type=SMS</code>.</p>
<p>Then we use the <code>platform.post()</code> function to call the <strong>subscription</strong> API with the specified event type.</p>
<p>After registered successfully, we parse the response to get the subscription Id and save it to the local &quot;subscriptionId.txt&quot; file.</p>
<p>That is all we need to setup for the notification subscription with PubNub.</p>
</div><div data-title="Delete PubNub notification" data-file="pubnub.js" data-highlight="87-106" class="step"><h2 id="renew-pubnub-notification">Renew PubNub notification</h2>
<p>Currently, a registered PubNub subscription will expire after 15 minutes. When a subscription expires, it&#39;s status will be in <code>Suspended</code> and RingCentral server will stop sending notification to that subscriber. Fortunately, the Node JS SDK has an auto renewal feature so that we don&#39;t need to renew the subscription manually.</p>
<p>When using PubNub notification, if we rerun the app, any subscription created by this app earlier will not be valid for the new process anymore. Thus, we will need to detect the old registered subscription and delete them, then create new subscription for the new process.</p>
</div><div data-title="Receive PubNub Notification" data-file="pubnub.js" data-highlight="17-20" class="step"><h2 id="receive-pubnub-notification-message">Receive PubNub notification message</h2>
<p>Whenever there is an incoming SMS, RingCentral will send a notification to the subscriber and we&#39;ll get notified via this function.</p>
<p>Then we call the <code>parseMessage()</code> with the data to process the SMS message.</p>
<p>We will process the SMS message the same way as we did in the Use WebHook sections.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="README.md" data-mode="markdown">IyBBMlAtU01TLU1lc3NhZ2luZwotIEJ1aWxkIGEgY3VycmVuY3kgY29udmVydGVyIHNlcnZpY2UgdXNpbmcgUmluZ0NlbnRyYWwgU01TIGZyYW1ld29yay4KLSBUaGlzIGRlbW8gcHJvamVjdCBzaG93cyBob3cgdG8gdXNlIFJpbmdDZW50cmFsIFNNUyBhbmQgUHVzaCBOb3RpZmljYXRpb24gQVBJcyB0byBpbXBsZW1lbnQgYSBTTVMgYm90LiBUaGUgYm90IHdpbGwgbGlzdGVuIGZvciBpbmNvbWluZyBTTVMgdGV4dCBjb21tYW5kcyB0aGVuIHJlcGx5IHRvIHRoZSBzZW5kZXIgd2l0aCByZWxldmFudCBjb250ZW50Lgo+IFRleHQgY29tbWFuZHM6Cj4gKiBfXz9fXyBPciBfX2hlbHBfXyBmb3IgZ2V0dGluZyBpbnN0cnVjdGlvbnMuCj4gKiBfX3N5bWJvbC9uX18gZm9yIGdldHRpbmcgYSBsaXN0IG9mIGZvcmVpZ24gY3VycmVuY3kgc3ltYm9scywgd2hlcmUgbiBpcyB0aGUgZmlyc3QgYWxwaGFiZXQgb2YgYSBjb3VudHJ54oCZcyBuYW1lLgo+ICogX19iYXNlL3RhcmdldF9fIGZvciBnZXR0aW5nIGEgY3VycmVudCBleGNoYW5nZSByYXRlLCB3aGVyZSB0YXJnZXQgaXMgdGhlIGN1cnJlbmN5IHN5bWJvbCB0byBiZSBxdW90ZWQgYWdhaW5zdCB0aGUgYmFzZSBjdXJyZW5jeSBzeW1ib2wuCgojIFNldHVwCmBgYApnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL3JpbmdjZW50cmFsLXR1dG9yaWFscy9hMnAtc21zLW1lc3NhZ2luZwpjZCBhMnAtc21zLW1lc3NhZ2luZwpucG0gaW50YWxsIC0tc2F2ZQpgYGAKLSBSZW5hbWUgdGhlIGRvdGVudiB0byAuZW52IGFuZCBwcm92aWRlIHlvdXIgYXBwIGNyZWRlbnRpYWxzLCBSaW5nQ2VudHJhbCBzYW5kYm94IGFjY291bnQncyB1c2VybmFtZSBhbmQgcGFzc3dvcmQKLSBSZXBsYWNlIHRoaXMgIllPVVJfV0VCSE9PS19BRERSRVNTIiB3aXRoIHlvdXIgd2ViaG9vayBhZGRyZXNzCj4gSWYgeW91IHJ1biB0aGUgYXBwIGluIGEgbG9jYWxob3N0LCB5b3UgY2FuIHVzZSBbbmdyb2tdKGh0dHBzOi8vbmdyb2suY29tL2Rvd25sb2FkKSB0byBnZXQgYW4gYWRkcmVzcwoKLSBJZiB5b3Ugd2FudCB0byB1c2UgUHViTnViIGZvciBub3RpZmljYXRpb24sIG9wZW4gdGhlIC5lbnYgZmlsZSBhbmQgY2hhbmdlIHRoZSB2YWx1ZSBvZiB0aGUgICBERUxJVkVSWV9NT0RFX1RSQU5TUE9SVF9UWVBFIHRvICJQdWJOdWIiIChpLmUuIERFTElWRVJZX01PREVfVFJBTlNQT1JUX1RZUEU9UHViTnViKQoKIyBSaW5nQ2VudHJhbCBEZXZlbG9wZXIgUG9ydGFsClRvIHNldHVwIGEgUmluZ0NlbnRyYWwgZGV2ZWxvcGVyIGZyZWUgYWNjb3VudCwgY2xpY2sgW2hlcmVdKGh0dHBzOi8vZGV2ZWxvcGVyL3JpbmdjZW50cmFsLmNvbSkKCiMgVGVjaG5vbG9naWVzIHVzZWQKLSBbUmluZ0NlbnRyYWwncyBTTVMgQVBJXShodHRwczovL2RldmVsb3Blci5yaW5nY2VudHJhbC5jb20vYXBpLWRvY3MvbGF0ZXN0L2luZGV4Lmh0bWwjISNSZWZTTVNNZXNzYWdlcy5odG1sKQotIFtSaW5nQ2VudHJhbCdzIFB1c2ggTm90aWZpY2F0aW9uIEFQSV0oaHR0cHM6Ly9kZXZlbG9wZXIucmluZ2NlbnRyYWwuY29tL2FwaS1kb2NzL2xhdGVzdC9pbmRleC5odG1sIyEjUmVmTm90aWZpY2F0aW9ucy5odG1sKQotIFtOb2RlLmpzXShodHRwczovL25vZGVqcy5vcmcvZW4vKQotIFtuZ3Jva10oaHR0cHM6Ly9uZ3Jvay5jb20vZG93bmxvYWQpIChvcHRpb25hbCkK</textarea>
<textarea class="saurus-file" data-file="dotenv" data-mode="text">UE9SVD0zMDAyCkxPQ0FMX0VOVj1sb2NhbGhvc3QKClJDX1NFUlZFUj1odHRwczovL3BsYXRmb3JtLmRldnRlc3QucmluZ2NlbnRyYWwuY29tClJDX0FQUF9LRVk9WW91cl9BcHBLZXkKUkNfQVBQX1NFQ1JFVD1Zb3VyX0FwcFNlY3JldAoKUkNfVVNFUk5BTUU9U2FuZGJveEFjY291bnRVc2VybmFtZQpSQ19QQVNTV09SRD1TYW5kYm94QWNjb3VudFBhc3N3b3JkClJDX0VYVEVOU0lPTj0KCkRFTElWRVJZX01PREVfVFJBTlNQT1JUX1RZUEU9V2ViSG9vawpERUxJVkVSWV9NT0RFX0FERFJFU1M9WU9VUl9XRUJIT09LX0FERFJFU1Mvd2ViaG9va3MK</textarea>
<textarea class="saurus-file" data-file="index.js" data-mode="javascript">dmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJykKdmFyIGh0dHAgPSByZXF1aXJlKCdodHRwJyk7CgovLyBMb2FkIGxvY2FsIGVudmlyb25tZW50IHZhcmlhYmxlcwppZigncHJvZHVjdGlvbicgIT09IHByb2Nlc3MuZW52LkxPQ0FMX0VOViApIHJlcXVpcmUoJ2RvdGVudicpLmxvYWQoKTsKCnZhciBwb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCA1MDAwCgp2YXIgcmNfc2VydmVyID0gbnVsbAp2YXIgc2VydmVyID0gbnVsbAppZiAocHJvY2Vzcy5lbnYuREVMSVZFUllfTU9ERV9UUkFOU1BPUlRfVFlQRSA9PSAiV2ViSG9vayIpewogIHNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKGZ1bmN0aW9uKHJlcSwgcmVzKSB7CiAgICAgIGlmIChyZXEubWV0aG9kID09ICdQT1NUJykgewogICAgICAgIGlmIChyZXEudXJsID09ICIvd2ViaG9va3MiKQogICAgICAgICAgcmNfc2VydmVyLmhhbmRsZVdlYmhvb2tzUG9zdChyZXEsIHJlcykKICAgICAgfWVsc2V7CiAgICAgICAgICBjb25zb2xlLmxvZygiSUdOT1JFIE9USEVSIE1FVEhPRFMiKQogICAgICB9CiAgfSk7CiAgcmNfc2VydmVyID0gcmVxdWlyZSgnLi93ZWJob29rJykKfWVsc2UgeyAvLyBVc2UgUHViTnViCiAgc2VydmVyID0gaHR0cC5jcmVhdGVTZXJ2ZXIoKQogIHJjX3NlcnZlciA9IHJlcXVpcmUoJy4vcHVibnViJykKfQpzZXJ2ZXIubGlzdGVuKHBvcnQpOwpyY19zZXJ2ZXIubG9naW4oKQo=</textarea>
<textarea class="saurus-file" data-file="webhook.js" data-mode="javascript">Ly8gRGVwZW5kZW5jaWVzCmNvbnN0IGh0dHAgPSByZXF1aXJlKCdodHRwJyk7CmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKQoKdmFyIGN1cnJlbmN5U3ltYm9scyA9IHsiYSI6IkFmZ2hhbmlzdGFuIEFmZ2hhbmkgPSBBRk47IEFyZ2VudGluYSBQZXNvID0gQVJTOyBBcnViYSBHdWlsZGVyID0gQVdHOyBBdXN0cmFsaWEgRG9sbGFyID0gQVVEOyBBemVyYmFpamFuIE5ldyBNYW5hdCA9IEFaTiIsImIiOiJCYWhhbWFzIERvbGxhciA9IEJTRDsgQmFyYmFkb3MgRG9sbGFyCT0gQkJEOyBCZWxhcnVzIFJ1YmxlID0gQllOOyBCZWxpemUgRG9sbGFyID0gQlpEOyBCZXJtdWRhIERvbGxhcgk9IEJNRDsgQm9saXZpYSBCb2xpdmlhbm8gPSBCT0I7IEJvc25pYSBhbmQgSGVyemVnb3ZpbmEgQ29udmVydGlibGUgTWFya2EgPSBCQU07IEJvdHN3YW5hIFB1bGEgPSBCV1A7IEJ1bGdhcmlhIExldiA9IEJHTjsgQnJhemlsIFJlYWwgPSBCUkw7IEJydW5laSBEYXJ1c3NhbGFtIERvbGxhciA9IEJORCIsImMiOiJDYW1ib2RpYSBSaWVsID0gS0hSOyBDYW5hZGEgRG9sbGFyID0gQ0FEOyBDYXltYW4gSXNsYW5kcyBEb2xsYXIgPSBLWUQ7IENoaWxlIFBlc28gPSBDTFA7IENoaW5hIFl1YW4gUmVubWluYmkgPSBDTlk7IENvbG9tYmlhIFBlc28JPSBDT1A7IENvc3RhIFJpY2EgQ29sb24gPSBDUkM7IENyb2F0aWEgS3VuYSA9IEhSSzsgQ3ViYSBQZXNvID0gQ1VQOyBDemVjaCBSZXB1YmxpYyBLb3J1bmEgPSBDWksiLCJkIjoiRGVubWFyayBLcm9uZQk9IERLSzsgRG9taW5pY2FuIFJlcHVibGljIFBlc28gPSBET1AiLCJlIjoiRWFzdCBDYXJpYmJlYW4gRG9sbGFyID0gWENEOyBFZ3lwdCBQb3VuZCA9IEVHUDsgRWwgU2FsdmFkb3IgQ29sb24gPSBTVkM7IEV1cm8gTWVtYmVyIENvdW50cmllcyA9IEVVUiIsImYiOiJGYWxrbGFuZCBJc2xhbmRzIChNYWx2aW5hcykgUG91bmQgPSBGS1A7IEZpamkgRG9sbGFyID0gRkpEIiwiZyI6IkdoYW5hIENlZGkgPSBHSFM7IEdpYnJhbHRhciBQb3VuZCA9IEdJUDsgR3VhdGVtYWxhIFF1ZXR6YWwgPSBHVFE7IEd1ZXJuc2V5IFBvdW5kID0gR0dQOyBHdXlhbmEgRG9sbGFyID0gR1lEIiwiaCI6IkhvbmR1cmFzIExlbXBpcmEgPSBITkw7IEhvbmcgS29uZyBEb2xsYXIgPSBIS0Q7IEh1bmdhcnkgRm9yaW50ID0gSFVGIiwiaSI6IkljZWxhbmQgS3JvbmEgPSBJU0s7IEluZGlhIFJ1cGVlID0gSU5SOyBJbmRvbmVzaWEgUnVwaWFoID0gSURSOyBJcmFuIFJpYWwgPSBJUlI7IElzbGUgb2YgTWFuIFBvdW5kID0gSU1QOyBJc3JhZWwgU2hla2VsID0gSUxTIiwiaiI6IkphbWFpY2EgRG9sbGFyID0gSk1EOyBKYXBhbiBZZW4gPSBKUFk7IEplcnNleSBQb3VuZCA9IEpFUCIsImsiOiJLYXpha2hzdGFuIFRlbmdlID0gS1pUOyBLb3JlYSAoTm9ydGgpIFdvbiA9IEtQVzsgS29yZWEgKFNvdXRoKSBXb24gPSBLUlc7IEt5cmd5enN0YW4gU29tID0gS0dTIiwibCI6Ikxhb3MgS2lwID0gTEFLOyBMZWJhbm9uIFBvdW5kID0gTEJQOyBMaWJlcmlhIERvbGxhciA9IExSRCIsIm0iOiJNYWNlZG9uaWEgRGVuYXIgPSBNS0Q7IE1hbGF5c2lhIFJpbmdnaXQgPSBNWVI7IE1hdXJpdGl1cyBSdXBlZSA9IE1VUjsgTWV4aWNvIFBlc28gPSBNWE47IE1vbmdvbGlhIFR1Z2hyaWsgPSBNTlQ7IE1vemFtYmlxdWUgTWV0aWNhbCA9IE1aTiIsIm4iOiJOYW1pYmlhIERvbGxhciA9IE5BRDsgTmVwYWwgUnVwZWUgPSBOUFI7IE5ldGhlcmxhbmRzIEFudGlsbGVzIEd1aWxkZXIgPSBBTkc7IE5ldyBaZWFsYW5kIERvbGxhciA9IE5aRDsgTmljYXJhZ3VhIENvcmRvYmEgPSBOSU87IE5pZ2VyaWEgTmFpcmEJTkdOOyBOb3J3YXkgS3JvbmUgPSBOT0siLCJvIjoiT21hbiBSaWFsID0gT01SIiwicCI6IlBha2lzdGFuIFJ1cGVlID0gUEtSOyBQYW5hbWEgQmFsYm9hID0gUEFCOyBQYXJhZ3VheSBHdWFyYW5pID0gUFlHOyBQZXJ1IFNvbCA9IFBFTjsgUGhpbGlwcGluZXMgUGVzbyA9IFBIUDsgUG9sYW5kIFpsb3R5ID0gUExOIiwicSI6IlFhdGFyIFJpeWFsID0gUUFSIiwiciI6IlJvbWFuaWEgTmV3IExldSA9IFJPTjsgUnVzc2lhIFJ1YmxlID0gUlVCIiwicyI6IlNhaW50IEhlbGVuYSBQb3VuZCA9IFNIUDsgU2F1ZGkgQXJhYmlhIFJpeWFsID0gU0FSOyBTZXJiaWEgRGluYXIgPSBSU0Q7IFNleWNoZWxsZXMgUnVwZWUgPSBTQ1IgPSBTaW5nYXBvcmUgRG9sbGFyID0gU0dEOyBTb2xvbW9uIElzbGFuZHMgRG9sbGFyID0gU0JEOyBTb21hbGlhIFNoaWxsaW5nID0gU09TOyBTb3V0aCBBZnJpY2EgUmFuZAlaQVI7IFNyaSBMYW5rYSBSdXBlZQlMS1I7IFN3ZWRlbiBLcm9uYSA9IFNFSzsgU3dpdHplcmxhbmQgRnJhbmMgPSBDSEY7IFN1cmluYW1lIERvbGxhcglTUkQ7IFN5cmlhIFBvdW5kID0gU1lQIiwidCI6IlRhaXdhbiBOZXcgRG9sbGFyID0gVFdEOyBUaGFpbGFuZCBCYWh0CVRIQjsgVHJpbmlkYWQgYW5kIFRvYmFnbyBEb2xsYXIgPSBUVEQ7IFR1cmtleSBMaXJhID0gVFJZOyBUdXZhbHUgRG9sbGFyID0gVFZEIiwidSI6IlVrcmFpbmUgSHJ5dm5pYSA9IFVBSDsgVW5pdGVkIEtpbmdkb20gUG91bmQgPSBHQlA7IFVuaXRlZCBTdGF0ZXMgRG9sbGFyID0gVVNEOyBVcnVndWF5IFBlc28gPSBVWVU7IFV6YmVraXN0YW4gU29tID0gVVpTIiwidiI6IlZlbmV6dWVsYSBCb2xpdmFyID0gVkVGOyBWaWV0IE5hbSBEb25nID0gVk5EIiwidyI6Ik5vIGN1cnJlbmN5IHN5bWJvbC4iLCJ4IjoiTm8gY3VycmVuY3kgc3ltYm9sLiIsInkiOiJZZW1lbiBSaWFsID0gWUVSIiwieiI6IlppbWJhYndlIERvbGxhciA9IFpXRCJ9OwoKLy8gSW5zdGFudGlhdGUgUkMtU0RLCmNvbnN0IFJDID0gcmVxdWlyZSgncmluZ2NlbnRyYWwnKTsKdmFyIHJjc2RrID0gbmV3IFJDKHsKICAgIHNlcnZlcjogcHJvY2Vzcy5lbnYuUkNfU0VSVkVSLAogICAgYXBwS2V5OiBwcm9jZXNzLmVudi5SQ19BUFBfS0VZLAogICAgYXBwU2VjcmV0OiBwcm9jZXNzLmVudi5SQ19BUFBfU0VDUkVUCn0pOwoKdmFyIHBsYXRmb3JtID0gcmNzZGsucGxhdGZvcm0oKTsKCm1vZHVsZS5leHBvcnRzID0gewogICAgIGxvZ2luOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcGxhdGZvcm0ubG9naW4oewogICAgICAgICAgICAgICAgdXNlcm5hbWU6IHByb2Nlc3MuZW52LlJDX1VTRVJOQU1FLAogICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LlJDX1BBU1NXT1JELAogICAgICAgICAgICAgICAgZXh0ZW5zaW9uOiBwcm9jZXNzLmVudi5SQ19FWFRFTlNJT04KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oYXV0aFJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBzdWJzY3JpYmVGb3JOb3RpZmljYXRpb24oKQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkZhaWxlZCBsb2dpbiIpOwogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgIH0pOwogICAgfSwKICAgIGhhbmRsZVdlYmhvb2tzUG9zdDogZnVuY3Rpb24ocmVxLCByZXMpIHsKICAgICAgICB2YXIgaGVhZGVycyA9IHJlcS5oZWFkZXJzOwogICAgICAgIHZhciB2YWxpZGF0aW9uVG9rZW4gPSBoZWFkZXJzWyd2YWxpZGF0aW9uLXRva2VuJ107CiAgICAgICAgdmFyIGJvZHkgPSBbXTsKICAgICAgICBpZih2YWxpZGF0aW9uVG9rZW4pIHsKICAgICAgICAgICAgcmVzLnNldEhlYWRlcignVmFsaWRhdGlvbi1Ub2tlbicsIHZhbGlkYXRpb25Ub2tlbik7CiAgICAgICAgICAgIHJlcy5zdGF0dXNDb2RlID0gMjAwOwogICAgICAgICAgICByZXMuZW5kKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxLm9uKCdkYXRhJywgZnVuY3Rpb24oY2h1bmspIHsKICAgICAgICAgICAgICAgIGJvZHkucHVzaChjaHVuayk7CiAgICAgICAgICAgIH0pLm9uKCdlbmQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJvZHkgPSBCdWZmZXIuY29uY2F0KGJvZHkpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB2YXIganNvbk9iaiA9IEpTT04ucGFyc2UoYm9keSkKICAgICAgICAgICAgICAgIHBhcnNlTWVzc2FnZShqc29uT2JqLmJvZHkpOwogICAgICAgICAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSAyMDA7CiAgICAgICAgICAgICAgICByZXMuZW5kKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KfTsKCmZ1bmN0aW9uIHN1YnNjcmliZUZvck5vdGlmaWNhdGlvbigpewogIGZzLnJlYWRGaWxlKCdzdWJzY3JpcHRpb25JZC50eHQnLCAndXRmOCcsIGZ1bmN0aW9uIChlcnIsZGF0YSkgewogICAgaWYgKGVycikgewogICAgICAgIHN0YXJ0V2ViaG9va1N1YnNjcmlwdGlvbigpCiAgICB9ZWxzZXsKICAgICAgICByZWFkUmVnaXN0ZXJlZFN1YnNjcmlwdGlvbihkYXRhKQogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBzdGFydFdlYmhvb2tTdWJzY3JpcHRpb24oKSB7CiAgdmFyIF9ldmVudEZpbHRlcnMgPSBbXTsKICBfZXZlbnRGaWx0ZXJzLnB1c2goJy9yZXN0YXBpL3YxLjAvYWNjb3VudC9+L2V4dGVuc2lvbi9+L21lc3NhZ2Utc3RvcmUvaW5zdGFudD90eXBlPVNNUycpOwogIHJldHVybiBwbGF0Zm9ybS5wb3N0KCcvc3Vic2NyaXB0aW9uJywKICB7CiAgICAgIGV2ZW50RmlsdGVyczogX2V2ZW50RmlsdGVycywKICAgICAgZGVsaXZlcnlNb2RlOiB7CiAgICAgICAgICB0cmFuc3BvcnRUeXBlOiBwcm9jZXNzLmVudi5ERUxJVkVSWV9NT0RFX1RSQU5TUE9SVF9UWVBFLAogICAgICAgICAgYWRkcmVzczogcHJvY2Vzcy5lbnYuREVMSVZFUllfTU9ERV9BRERSRVNTCiAgICAgIH0KICB9KQogIC50aGVuKGZ1bmN0aW9uKHN1YnNjcmlwdGlvblJlc3BvbnNlKSB7CiAgICAgIGNvbnNvbGUubG9nKCJSZWFkeSB0byByZWNlaXZlIGluY29taW5nIFNNUyB2aWEgV2ViSG9vay4iKQogICAgICB2YXIgc3Vic2NPYmogPSBzdWJzY3JpcHRpb25SZXNwb25zZS5qc29uKCk7CiAgICAgIGZzLndyaXRlRmlsZSgic3Vic2NyaXB0aW9uSWQudHh0Iiwgc3Vic2NPYmouaWQsIGZ1bmN0aW9uKGVycikgewogICAgICAgIGlmKGVycikgewogICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coIlN1YnNjcmlwdGlvbklkIGlzIHNhdmVkLiIpOwogICAgICB9KTsKCiAgfSkKICAuY2F0Y2goZnVuY3Rpb24oZSkgewogICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICB0aHJvdyBlOwogIH0pOwp9CgpmdW5jdGlvbiByZWFkUmVnaXN0ZXJlZFN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb25JZCkgewogICAgcGxhdGZvcm0uZ2V0KCcvc3Vic2NyaXB0aW9uJykKICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5qc29uKCk7CiAgICAgICAgaWYgKGRhdGEucmVjb3Jkcy5sZW5ndGggPiAwKXsKICAgICAgICAgIGZvcih2YXIgcmVjb3JkIG9mIGRhdGEucmVjb3JkcykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhyZWNvcmQpCiAgICAgICAgICAgIC8vcmV0dXJuIGRlbGV0ZVN1YnNjcmlwdGlvbihyZWNvcmQuaWQpCiAgICAgICAgICAgIGlmIChyZWNvcmQuaWQgPT0gc3Vic2NyaXB0aW9uSWQpIHsKICAgICAgICAgICAgICBpZiAocmVjb3JkLmRlbGl2ZXJ5TW9kZS50cmFuc3BvcnRUeXBlID09ICJXZWJIb29rIil7CiAgICAgICAgICAgICAgICBpZiAocmVjb3JkLnN0YXR1cyAhPT0gIkFjdGl2ZSIpewogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygic3Vic2NyaXB0aW9uIGlzIG5vdCBhY3RpdmUuIFJlbmV3IGl0IikKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmV3U3Vic2NyaXB0aW9uKHJlY29yZC5pZCkKICAgICAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coInN1YnNjcmlwdGlvbiBpcyBhY3RpdmUuIEdvb2QgdG8gZ28uIikKICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKCJObyBzdWJzY3JpcHRpb24gZm9yIHRoaXMgc2VydmljZSA9PiBDcmVhdGUgb25lIikKICAgICAgICBzdGFydFdlYmhvb2tTdWJzY3JpcHRpb24oKQogICAgICB9KQogICAgICAuY2F0Y2goZnVuY3Rpb24oZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgIHRocm93IGU7CiAgICAgIH0pOwp9CgpmdW5jdGlvbiBkZWxldGVTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uSWQpIHsKICAgIHJldHVybiBwbGF0Zm9ybQogICAgICAuZGVsZXRlKCcvc3Vic2NyaXB0aW9uLycgKyBzdWJzY3JpcHRpb25JZCkKICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgY29uc29sZS5sb2coImRlbGV0ZWQ6ICIgKyBzdWJzY3JpcHRpb25JZCkKICAgICAgfSkKICAgICAgLmNhdGNoKGZ1bmN0aW9uKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHRocm93IGU7CiAgICAgIH0pOwp9CgpmdW5jdGlvbiByZW5ld1N1YnNjcmlwdGlvbihzdWJzY3JpcHRpb25JZCkgewogICAgcmV0dXJuIHBsYXRmb3JtCiAgICAgIC5wb3N0KCcvc3Vic2NyaXB0aW9uLycgKyBzdWJzY3JpcHRpb25JZCArICIvcmVuZXciKQogICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZDogIiArIHN1YnNjcmlwdGlvbklkKQogICAgICB9KQogICAgICAuY2F0Y2goZnVuY3Rpb24oZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgdGhyb3cgZTsKICAgICAgfSk7Cn0KCmZ1bmN0aW9uIHBhcnNlTWVzc2FnZShtZXNzYWdlKSB7CiAgICB2YXIgdG9OdW1iZXIgPSBtZXNzYWdlWydmcm9tJ11bJ3Bob25lTnVtYmVyJ107CiAgICB2YXIgY29tbWFuZCA9IG1lc3NhZ2VbJ3N1YmplY3QnXTsKICAgIC8vIGZvciB0ZXN0aW5nIHdpdGggc2FuZGJveCBhY2NvdW50LiBXZSByZW1vdmUgdGhlIHdhdGVybWFyayB0ZXh0CiAgICB2YXIgd2F0ZXJtYXJrID0gIlRlc3QgU01TIHVzaW5nIGEgUmluZ0NlbnRyYWwgRGV2ZWxvcGVyIGFjY291bnQgLSAiCiAgICB2YXIgaW5kZXggPSBjb21tYW5kLmluZGV4T2Yod2F0ZXJtYXJrKQogICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICBjb21tYW5kID0gY29tbWFuZC5zdWJzdHIod2F0ZXJtYXJrLmxlbmd0aCwgY29tbWFuZC5sZW5ndGgpCiAgICB9CiAgICBjb21tYW5kID0gY29tbWFuZC50b0xvd2VyQ2FzZSgpLnRyaW0oKQoKICAgIGlmIChjb21tYW5kID09ICI/IiB8fCBjb21tYW5kID09ICJoZWxwIikgewogICAgICAgIHZhciByZXNwb25zZSA9ICdGb3IgY3VycmVuY3kgc3ltYm9scywgc2VuZCAic3ltYm9sL24iLCB3aGVyZSAibiIgaXMgdGhlIGZpcnN0IGFscGhhYmV0IGxldHRlciBvZiBhIGNvdW50cnkgbmFtZS5cbkZvciBleGNoYW5nZSByYXRlLCBzZW5kIGUuZy4gImV1ci91c2QiLCB3aGVyZSAiZXVyIiBpcyB0aGUgYmFzZSBhbmQgInVzZCIgaXMgdGhlIHRhcmdldC4nOwogICAgICAgIHJldHVybiBzZW5kU01TTWVzc2FnZSh0b051bWJlciwgcmVzcG9uc2UpCiAgICB9IGVsc2UgaWYgKGNvbW1hbmQuaW5jbHVkZXMoJy8nKSkgewogICAgICAgIHZhciBjdXJyZW5jaWVzID0gY29tbWFuZC5zcGxpdCgiLyIpOwogICAgICAgIHZhciBjdXJyZW5jeUJhc2UgPSBjdXJyZW5jaWVzWzBdLnRyaW0oKS50b1VwcGVyQ2FzZSgpOwogICAgICAgIHZhciBjdXJyZW5jeVRhcmdldCA9IGN1cnJlbmNpZXNbMV0udHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgaWYgKGN1cnJlbmN5QmFzZSA9PSAiU1lNQk9MIikgewogICAgICAgICAgICBjdXJyZW5jeVRhcmdldCA9IGN1cnJlbmN5VGFyZ2V0LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIHZhciBzeW1ib2xzID0gY3VycmVuY3lTeW1ib2xzW2N1cnJlbmN5VGFyZ2V0XTsKICAgICAgICAgICAgcmV0dXJuIHNlbmRTTVNNZXNzYWdlKHRvTnVtYmVyLCBzeW1ib2xzKQogICAgICAgIH0gZWxzZSBpZiAoY3VycmVuY3lCYXNlLmxlbmd0aCA9PSAzICYmIGN1cnJlbmN5VGFyZ2V0Lmxlbmd0aCA9PSAzKSB7CiAgICAgICAgICAgIHZhciBob3N0ID0gJ2FwaS5maXhlci5pbycKICAgICAgICAgICAgdmFyIHBhdGggPSAnL2xhdGVzdD9iYXNlPScgKyBjdXJyZW5jeUJhc2UgKyAnJnN5bWJvbHM9JyArIGN1cnJlbmN5VGFyZ2V0OwogICAgICAgICAgICBodHRwLmdldCh7CiAgICAgICAgICAgICAgICBob3N0OiBob3N0LAogICAgICAgICAgICAgICAgcGF0aDogcGF0aAogICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgLy8gQ29udGludW91c2x5IHVwZGF0ZSBzdHJlYW0gd2l0aCBkYXRhCiAgICAgICAgICAgICAgICB2YXIgYm9keSA9ICcnOwogICAgICAgICAgICAgICAgcmVzcG9uc2Uub24oJ2RhdGEnLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgYm9keSArPSBkOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXNwb25zZS5vbignZW5kJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRGF0YSByZWNlcHRpb24gaXMgZG9uZQogICAgICAgICAgICAgICAgICAgIHZhciBwYXJzZWQgPSBKU09OLnBhcnNlKGJvZHkpOwogICAgICAgICAgICAgICAgICAgIHZhciBleGNoYWdlUmF0ZSA9ICcxJyArIHBhcnNlZC5iYXNlICsgJz0+JyArIHBhcnNlZC5yYXRlc1tjdXJyZW5jeVRhcmdldF0gKyBjdXJyZW5jeVRhcmdldDsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleGNoYWdlUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbmRTTVNNZXNzYWdlKHRvTnVtYmVyLCBleGNoYWdlUmF0ZSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgIHZhciB0ZXh0TWVzc2FnZSA9ICdJbnZhbGlkIGN1cnJlbmN5IHN5bWJvbCEnCiAgICAgICAgICAgcmV0dXJuIHNlbmRTTVNNZXNzYWdlKHRvTnVtYmVyLCB0ZXh0TWVzc2FnZSkKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHZhciB0ZXh0TWVzc2FnZSA9ICdJbnZhbGlkIGNvbW1hbmQhIFNlbmQgSEVMUCBvciA/IGZvciBoZWxwLicKICAgICAgICByZXR1cm4gc2VuZFNNU01lc3NhZ2UodG9OdW1iZXIsIHRleHRNZXNzYWdlKQogICAgfQp9CgpmdW5jdGlvbiBzZW5kU01TTWVzc2FnZSh0b051bWJlciwgdGV4dE1lc3NhZ2UpIHsKICAgIHJldHVybiBwbGF0Zm9ybS5wb3N0KCcvYWNjb3VudC9+L2V4dGVuc2lvbi9+L3NtcycsIHsKICAgICAgICAgZnJvbTogeydwaG9uZU51bWJlcic6IHByb2Nlc3MuZW52LlJDX1VTRVJOQU1FfSwKICAgICAgICAgdG86IFt7J3Bob25lTnVtYmVyJzogdG9OdW1iZXJ9XSwKICAgICAgICAgdGV4dDogdGV4dE1lc3NhZ2UKICAgICAgIH0pCiAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKCiAgICAgICB9KTsKfQo=</textarea>
<textarea class="saurus-file" data-file="pubnub.js" data-mode="javascript">Ly8gRGVwZW5kZW5jaWVzCmNvbnN0IGh0dHAgPSByZXF1aXJlKCdodHRwJyk7CmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKQoKdmFyIGN1cnJlbmN5U3ltYm9scyA9IHsiYSI6IkFmZ2hhbmlzdGFuIEFmZ2hhbmkgPSBBRk47IEFyZ2VudGluYSBQZXNvID0gQVJTOyBBcnViYSBHdWlsZGVyID0gQVdHOyBBdXN0cmFsaWEgRG9sbGFyID0gQVVEOyBBemVyYmFpamFuIE5ldyBNYW5hdCA9IEFaTiIsImIiOiJCYWhhbWFzIERvbGxhciA9IEJTRDsgQmFyYmFkb3MgRG9sbGFyCT0gQkJEOyBCZWxhcnVzIFJ1YmxlID0gQllOOyBCZWxpemUgRG9sbGFyID0gQlpEOyBCZXJtdWRhIERvbGxhcgk9IEJNRDsgQm9saXZpYSBCb2xpdmlhbm8gPSBCT0I7IEJvc25pYSBhbmQgSGVyemVnb3ZpbmEgQ29udmVydGlibGUgTWFya2EgPSBCQU07IEJvdHN3YW5hIFB1bGEgPSBCV1A7IEJ1bGdhcmlhIExldiA9IEJHTjsgQnJhemlsIFJlYWwgPSBCUkw7IEJydW5laSBEYXJ1c3NhbGFtIERvbGxhciA9IEJORCIsImMiOiJDYW1ib2RpYSBSaWVsID0gS0hSOyBDYW5hZGEgRG9sbGFyID0gQ0FEOyBDYXltYW4gSXNsYW5kcyBEb2xsYXIgPSBLWUQ7IENoaWxlIFBlc28gPSBDTFA7IENoaW5hIFl1YW4gUmVubWluYmkgPSBDTlk7IENvbG9tYmlhIFBlc28JPSBDT1A7IENvc3RhIFJpY2EgQ29sb24gPSBDUkM7IENyb2F0aWEgS3VuYSA9IEhSSzsgQ3ViYSBQZXNvID0gQ1VQOyBDemVjaCBSZXB1YmxpYyBLb3J1bmEgPSBDWksiLCJkIjoiRGVubWFyayBLcm9uZQk9IERLSzsgRG9taW5pY2FuIFJlcHVibGljIFBlc28gPSBET1AiLCJlIjoiRWFzdCBDYXJpYmJlYW4gRG9sbGFyID0gWENEOyBFZ3lwdCBQb3VuZCA9IEVHUDsgRWwgU2FsdmFkb3IgQ29sb24gPSBTVkM7IEV1cm8gTWVtYmVyIENvdW50cmllcyA9IEVVUiIsImYiOiJGYWxrbGFuZCBJc2xhbmRzIChNYWx2aW5hcykgUG91bmQgPSBGS1A7IEZpamkgRG9sbGFyID0gRkpEIiwiZyI6IkdoYW5hIENlZGkgPSBHSFM7IEdpYnJhbHRhciBQb3VuZCA9IEdJUDsgR3VhdGVtYWxhIFF1ZXR6YWwgPSBHVFE7IEd1ZXJuc2V5IFBvdW5kID0gR0dQOyBHdXlhbmEgRG9sbGFyID0gR1lEIiwiaCI6IkhvbmR1cmFzIExlbXBpcmEgPSBITkw7IEhvbmcgS29uZyBEb2xsYXIgPSBIS0Q7IEh1bmdhcnkgRm9yaW50ID0gSFVGIiwiaSI6IkljZWxhbmQgS3JvbmEgPSBJU0s7IEluZGlhIFJ1cGVlID0gSU5SOyBJbmRvbmVzaWEgUnVwaWFoID0gSURSOyBJcmFuIFJpYWwgPSBJUlI7IElzbGUgb2YgTWFuIFBvdW5kID0gSU1QOyBJc3JhZWwgU2hla2VsID0gSUxTIiwiaiI6IkphbWFpY2EgRG9sbGFyID0gSk1EOyBKYXBhbiBZZW4gPSBKUFk7IEplcnNleSBQb3VuZCA9IEpFUCIsImsiOiJLYXpha2hzdGFuIFRlbmdlID0gS1pUOyBLb3JlYSAoTm9ydGgpIFdvbiA9IEtQVzsgS29yZWEgKFNvdXRoKSBXb24gPSBLUlc7IEt5cmd5enN0YW4gU29tID0gS0dTIiwibCI6Ikxhb3MgS2lwID0gTEFLOyBMZWJhbm9uIFBvdW5kID0gTEJQOyBMaWJlcmlhIERvbGxhciA9IExSRCIsIm0iOiJNYWNlZG9uaWEgRGVuYXIgPSBNS0Q7IE1hbGF5c2lhIFJpbmdnaXQgPSBNWVI7IE1hdXJpdGl1cyBSdXBlZSA9IE1VUjsgTWV4aWNvIFBlc28gPSBNWE47IE1vbmdvbGlhIFR1Z2hyaWsgPSBNTlQ7IE1vemFtYmlxdWUgTWV0aWNhbCA9IE1aTiIsIm4iOiJOYW1pYmlhIERvbGxhciA9IE5BRDsgTmVwYWwgUnVwZWUgPSBOUFI7IE5ldGhlcmxhbmRzIEFudGlsbGVzIEd1aWxkZXIgPSBBTkc7IE5ldyBaZWFsYW5kIERvbGxhciA9IE5aRDsgTmljYXJhZ3VhIENvcmRvYmEgPSBOSU87IE5pZ2VyaWEgTmFpcmEJTkdOOyBOb3J3YXkgS3JvbmUgPSBOT0siLCJvIjoiT21hbiBSaWFsID0gT01SIiwicCI6IlBha2lzdGFuIFJ1cGVlID0gUEtSOyBQYW5hbWEgQmFsYm9hID0gUEFCOyBQYXJhZ3VheSBHdWFyYW5pID0gUFlHOyBQZXJ1IFNvbCA9IFBFTjsgUGhpbGlwcGluZXMgUGVzbyA9IFBIUDsgUG9sYW5kIFpsb3R5ID0gUExOIiwicSI6IlFhdGFyIFJpeWFsID0gUUFSIiwiciI6IlJvbWFuaWEgTmV3IExldSA9IFJPTjsgUnVzc2lhIFJ1YmxlID0gUlVCIiwicyI6IlNhaW50IEhlbGVuYSBQb3VuZCA9IFNIUDsgU2F1ZGkgQXJhYmlhIFJpeWFsID0gU0FSOyBTZXJiaWEgRGluYXIgPSBSU0Q7IFNleWNoZWxsZXMgUnVwZWUgPSBTQ1IgPSBTaW5nYXBvcmUgRG9sbGFyID0gU0dEOyBTb2xvbW9uIElzbGFuZHMgRG9sbGFyID0gU0JEOyBTb21hbGlhIFNoaWxsaW5nID0gU09TOyBTb3V0aCBBZnJpY2EgUmFuZAlaQVI7IFNyaSBMYW5rYSBSdXBlZQlMS1I7IFN3ZWRlbiBLcm9uYSA9IFNFSzsgU3dpdHplcmxhbmQgRnJhbmMgPSBDSEY7IFN1cmluYW1lIERvbGxhcglTUkQ7IFN5cmlhIFBvdW5kID0gU1lQIiwidCI6IlRhaXdhbiBOZXcgRG9sbGFyID0gVFdEOyBUaGFpbGFuZCBCYWh0CVRIQjsgVHJpbmlkYWQgYW5kIFRvYmFnbyBEb2xsYXIgPSBUVEQ7IFR1cmtleSBMaXJhID0gVFJZOyBUdXZhbHUgRG9sbGFyID0gVFZEIiwidSI6IlVrcmFpbmUgSHJ5dm5pYSA9IFVBSDsgVW5pdGVkIEtpbmdkb20gUG91bmQgPSBHQlA7IFVuaXRlZCBTdGF0ZXMgRG9sbGFyID0gVVNEOyBVcnVndWF5IFBlc28gPSBVWVU7IFV6YmVraXN0YW4gU29tID0gVVpTIiwidiI6IlZlbmV6dWVsYSBCb2xpdmFyID0gVkVGOyBWaWV0IE5hbSBEb25nID0gVk5EIiwidyI6Ik5vIGN1cnJlbmN5IHN5bWJvbC4iLCJ4IjoiTm8gY3VycmVuY3kgc3ltYm9sLiIsInkiOiJZZW1lbiBSaWFsID0gWUVSIiwieiI6IlppbWJhYndlIERvbGxhciA9IFpXRCJ9OwoKLy8gSW5zdGFudGlhdGUgUkMtU0RLCmNvbnN0IFJDID0gcmVxdWlyZSgncmluZ2NlbnRyYWwnKTsKdmFyIHJjc2RrID0gbmV3IFJDKHsKICAgIHNlcnZlcjogcHJvY2Vzcy5lbnYuUkNfU0VSVkVSLAogICAgYXBwS2V5OiBwcm9jZXNzLmVudi5SQ19BUFBfS0VZLAogICAgYXBwU2VjcmV0OiBwcm9jZXNzLmVudi5SQ19BUFBfU0VDUkVUCn0pOwoKdmFyIHBsYXRmb3JtID0gcmNzZGsucGxhdGZvcm0oKTsKdmFyIHN1YnNjcmlwdGlvbiA9IHJjc2RrLmNyZWF0ZVN1YnNjcmlwdGlvbigpOwovLyBldmVudCBub3RpZmljYXRpb24gdmlhIFB1Yk51YgpzdWJzY3JpcHRpb24ub24oc3Vic2NyaXB0aW9uLmV2ZW50cy5ub3RpZmljYXRpb24sIGZ1bmN0aW9uKG1zZykgewogICAgcGFyc2VNZXNzYWdlKG1zZy5ib2R5KTsKfSk7Cgptb2R1bGUuZXhwb3J0cyA9IHsKICAgICBsb2dpbjogZnVuY3Rpb24gKCkgewogICAgICAgIHBsYXRmb3JtLmxvZ2luKHsKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBwcm9jZXNzLmVudi5SQ19VU0VSTkFNRSwKICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5SQ19QQVNTV09SRCwKICAgICAgICAgICAgICAgIGV4dGVuc2lvbjogcHJvY2Vzcy5lbnYuUkNfRVhURU5TSU9OCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGF1dGhSZXNwb25zZSkgewogICAgICAgICAgICAgICAgc3Vic2NyaWJlRm9yTm90aWZpY2F0aW9uKCkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJGYWlsZWQgbG9naW4iKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9KTsKICAgIH0KfTsKCmZ1bmN0aW9uIHN1YnNjcmliZUZvck5vdGlmaWNhdGlvbigpewogIGZzLnJlYWRGaWxlKCdzdWJzY3JpcHRpb25JZC50eHQnLCAndXRmOCcsIGZ1bmN0aW9uIChlcnIsZGF0YSkgewogICAgaWYgKGVycikgewogICAgICAgIHN0YXJ0UHViTnViU3Vic2NyaXB0aW9uKCkKICAgIH1lbHNlewogICAgICAgIHJlYWRSZWdpc3RlcmVkU3Vic2NyaXB0aW9uKGRhdGEpCiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIHNhdmVTdWJzY3JpcHRpb25JZChzdWJzY3JpcHRpb25JZCl7CiAgZnMud3JpdGVGaWxlKCJzdWJzY3JpcHRpb25JZC50eHQiLCBzdWJzY3JpcHRpb25JZCwgZnVuY3Rpb24oZXJyKSB7CiAgICBpZihlcnIpIHsKICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgIH0KICAgIGNvbnNvbGUubG9nKCJTdWJzY3JpcHRpb25JZCBpcyBzYXZlZC4iKTsKICB9KTsKfQoKZnVuY3Rpb24gc3RhcnRQdWJOdWJTdWJzY3JpcHRpb24gKCkgewogIHZhciBfZXZlbnRGaWx0ZXJzID0gW107CiAgX2V2ZW50RmlsdGVycy5wdXNoKCcvcmVzdGFwaS92MS4wL2FjY291bnQvfi9leHRlbnNpb24vfi9tZXNzYWdlLXN0b3JlL2luc3RhbnQ/dHlwZT1TTVMnKTsKICBzdWJzY3JpcHRpb24uc2V0RXZlbnRGaWx0ZXJzKF9ldmVudEZpbHRlcnMpCiAgLnJlZ2lzdGVyKCkKICAudGhlbihmdW5jdGlvbihzdWJzY3JpcHRpb25SZXNwb25zZSkgewogICAgICBjb25zb2xlLmxvZygiUmVhZHkgdG8gcmVjZWl2ZSBpbmNvbWluZyBTTVMgdmlhIFB1Yk51Yi4iKQogICAgICB2YXIgc3Vic2NPYmogPSBzdWJzY3JpcHRpb25SZXNwb25zZS5qc29uKCk7CiAgICAgIHNhdmVTdWJzY3JpcHRpb25JZChzdWJzY09iai5pZCkKICB9KQogIC5jYXRjaChmdW5jdGlvbihlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgIHRocm93IGU7CiAgfSk7Cn0KCmZ1bmN0aW9uIGRlbGV0ZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb25JZCkgewogICAgcmV0dXJuIHBsYXRmb3JtCiAgICAgIC5kZWxldGUoJy9zdWJzY3JpcHRpb24vJyArIHN1YnNjcmlwdGlvbklkKQogICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBjb25zb2xlLmxvZygiZGVsZXRlZDogIiArIHN1YnNjcmlwdGlvbklkKQogICAgICB9KQogICAgICAuY2F0Y2goZnVuY3Rpb24oZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgdGhyb3cgZTsKICAgICAgfSk7Cn0KCmZ1bmN0aW9uIHJlYWRSZWdpc3RlcmVkU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbklkKSB7CiAgICBwbGF0Zm9ybS5nZXQoJy9zdWJzY3JpcHRpb24nKQogICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICBpZiAoZGF0YS5yZWNvcmRzLmxlbmd0aCA+IDApewogICAgICAgICAgZm9yKHZhciByZWNvcmQgb2YgZGF0YS5yZWNvcmRzKSB7CiAgICAgICAgICAgIGlmIChyZWNvcmQuaWQgPT0gc3Vic2NyaXB0aW9uSWQpIHsKICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBvbGQgc3Vic2NyaXB0aW9uIGJlZm9yZSBjcmVhdGluZyBhIG5ldyBvbmUKICAgICAgICAgICAgICAgIGRlbGV0ZVN1YnNjcmlwdGlvbihyZWNvcmQuaWQpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coIkNyZWF0ZSBuZXcgc3Vic2NyaXB0aW9uIikKICAgICAgICBzdGFydFB1Yk51YlN1YnNjcmlwdGlvbigpCiAgICAgIH0pCiAgICAgIC5jYXRjaChmdW5jdGlvbihlKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgICAgdGhyb3cgZTsKICAgICAgfSk7Cn0KCmZ1bmN0aW9uIHBhcnNlTWVzc2FnZShtZXNzYWdlKSB7CiAgICB2YXIgdG9OdW1iZXIgPSBtZXNzYWdlWydmcm9tJ11bJ3Bob25lTnVtYmVyJ107CiAgICB2YXIgY29tbWFuZCA9IG1lc3NhZ2VbJ3N1YmplY3QnXTsKICAgIC8vIGZvciB0ZXN0aW5nIHdpdGggc2FuZGJveCBhY2NvdW50LiBXZSByZW1vdmUgdGhlIHdhdGVybWFyayB0ZXh0CiAgICB2YXIgd2F0ZXJtYXJrID0gIlRlc3QgU01TIHVzaW5nIGEgUmluZ0NlbnRyYWwgRGV2ZWxvcGVyIGFjY291bnQgLSAiCiAgICB2YXIgaW5kZXggPSBjb21tYW5kLmluZGV4T2Yod2F0ZXJtYXJrKQogICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICBjb21tYW5kID0gY29tbWFuZC5zdWJzdHIod2F0ZXJtYXJrLmxlbmd0aCwgY29tbWFuZC5sZW5ndGgpCiAgICB9CiAgICBjb21tYW5kID0gY29tbWFuZC50b0xvd2VyQ2FzZSgpLnRyaW0oKQoKICAgIGlmIChjb21tYW5kID09ICI/IiB8fCBjb21tYW5kID09ICJoZWxwIikgewogICAgICAgIHZhciByZXNwb25zZSA9ICdGb3IgY3VycmVuY3kgc3ltYm9scywgc2VuZCAic3ltYm9sL24iLCB3aGVyZSAibiIgaXMgdGhlIGZpcnN0IGFscGhhYmV0IGxldHRlciBvZiBhIGNvdW50cnkgbmFtZS5cbkZvciBleGNoYW5nZSByYXRlLCBzZW5kIGUuZy4gImV1ci91c2QiLCB3aGVyZSAiZXVyIiBpcyB0aGUgYmFzZSBhbmQgInVzZCIgaXMgdGhlIHRhcmdldC4nOwogICAgICAgIHJldHVybiBzZW5kU01TTWVzc2FnZSh0b051bWJlciwgcmVzcG9uc2UpCiAgICB9IGVsc2UgaWYgKGNvbW1hbmQuaW5jbHVkZXMoJy8nKSkgewogICAgICAgIHZhciBjdXJyZW5jaWVzID0gY29tbWFuZC5zcGxpdCgiLyIpOwogICAgICAgIHZhciBjdXJyZW5jeUJhc2UgPSBjdXJyZW5jaWVzWzBdLnRyaW0oKS50b1VwcGVyQ2FzZSgpOwogICAgICAgIHZhciBjdXJyZW5jeVRhcmdldCA9IGN1cnJlbmNpZXNbMV0udHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgaWYgKGN1cnJlbmN5QmFzZSA9PSAiU1lNQk9MIikgewogICAgICAgICAgICBjdXJyZW5jeVRhcmdldCA9IGN1cnJlbmN5VGFyZ2V0LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIHZhciBzeW1ib2xzID0gY3VycmVuY3lTeW1ib2xzW2N1cnJlbmN5VGFyZ2V0XTsKICAgICAgICAgICAgcmV0dXJuIHNlbmRTTVNNZXNzYWdlKHRvTnVtYmVyLCBzeW1ib2xzKQogICAgICAgIH0gZWxzZSBpZiAoY3VycmVuY3lCYXNlLmxlbmd0aCA9PSAzICYmIGN1cnJlbmN5VGFyZ2V0Lmxlbmd0aCA9PSAzKSB7CiAgICAgICAgICAgIHZhciBob3N0ID0gJ2FwaS5maXhlci5pbycKICAgICAgICAgICAgdmFyIHBhdGggPSAnL2xhdGVzdD9iYXNlPScgKyBjdXJyZW5jeUJhc2UgKyAnJnN5bWJvbHM9JyArIGN1cnJlbmN5VGFyZ2V0OwogICAgICAgICAgICBodHRwLmdldCh7CiAgICAgICAgICAgICAgICBob3N0OiBob3N0LAogICAgICAgICAgICAgICAgcGF0aDogcGF0aAogICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgLy8gQ29udGludW91c2x5IHVwZGF0ZSBzdHJlYW0gd2l0aCBkYXRhCiAgICAgICAgICAgICAgICB2YXIgYm9keSA9ICcnOwogICAgICAgICAgICAgICAgcmVzcG9uc2Uub24oJ2RhdGEnLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgYm9keSArPSBkOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXNwb25zZS5vbignZW5kJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRGF0YSByZWNlcHRpb24gaXMgZG9uZQogICAgICAgICAgICAgICAgICAgIHZhciBwYXJzZWQgPSBKU09OLnBhcnNlKGJvZHkpOwogICAgICAgICAgICAgICAgICAgIHZhciBleGNoYWdlUmF0ZSA9ICcxJyArIHBhcnNlZC5iYXNlICsgJz0+JyArIHBhcnNlZC5yYXRlc1tjdXJyZW5jeVRhcmdldF0gKyBjdXJyZW5jeVRhcmdldDsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleGNoYWdlUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbmRTTVNNZXNzYWdlKHRvTnVtYmVyLCBleGNoYWdlUmF0ZSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgIHZhciB0ZXh0TWVzc2FnZSA9ICdJbnZhbGlkIGN1cnJlbmN5IHN5bWJvbCEnCiAgICAgICAgICAgcmV0dXJuIHNlbmRTTVNNZXNzYWdlKHRvTnVtYmVyLCB0ZXh0TWVzc2FnZSkKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHZhciB0ZXh0TWVzc2FnZSA9ICdJbnZhbGlkIGNvbW1hbmQhIFNlbmQgSEVMUCBvciA/IGZvciBoZWxwLicKICAgICAgICByZXR1cm4gc2VuZFNNU01lc3NhZ2UodG9OdW1iZXIsIHRleHRNZXNzYWdlKQogICAgfQp9CgpmdW5jdGlvbiBzZW5kU01TTWVzc2FnZSh0b051bWJlciwgdGV4dE1lc3NhZ2UpIHsKICAgIHJldHVybiBwbGF0Zm9ybS5wb3N0KCcvYWNjb3VudC9+L2V4dGVuc2lvbi9+L3NtcycsIHsKICAgICAgICAgZnJvbTogeydwaG9uZU51bWJlcic6IHByb2Nlc3MuZW52LlJDX1VTRVJOQU1FfSwKICAgICAgICAgdG86IFt7J3Bob25lTnVtYmVyJzogdG9OdW1iZXJ9XSwKICAgICAgICAgdGV4dDogdGV4dE1lc3NhZ2UKICAgICAgIH0pCiAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKCiAgICAgICB9KTsKfQo=</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><div class="saurus-file-actions"><a href="https://github.com/ringcentral-tutorials/a2p-sms-messaging" target="_blank" class="explorer-get-code"><i class="fa fa-lg fa-github-square"></i>View Code on GitHub</a><a href="https://github.com/ringcentral-tutorials/a2p-sms-messaging/archive/master.zip" target="_blank" class="explorer-get-code"><i class="fa fa-lg icon-download"></i>Download Source Code</a></div></div></div></div><footer><div class="footer-content"><div class="footer-content-row layout-2-cols"><div class="footer-content-row-left"><div class="footer-logo"><a href="http://www.ringcentral.com"><span>Back to the main site</span></a></div></div><div class="footer-content-row-right"><ul class="footer-text-links"><li><a href="http://www.ringcentral.com/legal.html" target="_blank"><span>Legal</span></a></li><li><a href="http://www.ringcentral.com/security-statement.html" target="_blank"><span>Security Policy</span></a></li><li><a href="http://www.ringcentral.com/legal/privacy-policy.html" target="_blank"><span>Privacy Policy</span></a></li><li><a ng-href="https://devcommunity.ringcentral.com" target="_blank" href="https://devcommunity.ringcentral.com"><span>Community</span></a></li><li><a href="https://medium.com/ringcentral-developers" target="_blank"><span>Blog</span></a></li></ul></div></div><div class="footer-content-row footer-content-row-last layout-2-cols"><div class="footer-content-row-left"><span class="footer-copyright">© 1999-<span ng-bind="::main.nowObj|date:'yyyy'" class="footer-copyright-to ng-binding">2017</span> RingCentral, Inc. All rights reserved.</span></div><div class="footer-content-row-right"><div class="footer-image-links"><div class="footer-image-link footer-image-link-facebook"><a target="_blank" href="http://www.facebook.com/ringcentral"><i class="fa icon-facebook"></i></a></div><div class="footer-image-link footer-image-link-twitter"><a target="_blank" href="http://twitter.com/ringcentraldevs"><i class="fa icon-twitter"></i></a></div><div class="footer-image-link footer-image-link-google-plus"><a target="_blank" href="https://www.google.com/+ringcentral"><i class="fa icon-google_plus"></i></a></div><div class="footer-image-link footer-image-link-linkedin"><a target="_blank" href="http://www.linkedin.com/company/ringcentral"><i class="fa icon-linkedin"></i></a></div><div class="footer-image-link footer-image-link-youtube"><a target="_blank" href="http://www.youtube.com/ringcentral"><i class="fa icon-youtube"></i></a></div></div></div></div></div></footer></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script>window.tutorialName="Build your A2P SMS Messaging";</script><script src="viewsaurus.js"></script></body></html>